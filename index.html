<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de LED</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    var accessToken = "ed2b4b082b6e7f701101ccb4b469675e45735485";
    var deviceID = "0a10aced202194944a055c30";
    var url = "https://api.particle.io/v1/devices/" + deviceID + "/led";

    function updateStatus(message) {
      document.getElementById("status").textContent = message;
    }

    // ✅ Esta es la función corregida
    function getCurrentLEDStatus() {
      $.ajax({
        url: url,
        type: "GET",
        headers: {
          "Authorization": "Bearer " + accessToken
        },
        success: function(data) {
          if (data.result === 1) {
            updateStatus("Estado: LED ENCENDIDO");
          } else if (data.result === 0) {
            updateStatus("Estado: LED APAGADO");
          } else {
            updateStatus("Estado: Desconocido");
          }
        },
        error: function(xhr) {
          updateStatus("Error al obtener el estado: " + xhr.status + " – " + xhr.responseText);
        }
      });
    }

    function handleResponse(data) {
      var value = data.return_value;
      if (value === 1) {
        updateStatus("Estado: LED ENCENDIDO");
      } else if (value === 0) {
        updateStatus("Estado: LED APAGADO");
      } else if (value === -1) {
        updateStatus("Estado: Parámetro inválido");
      } else {
        updateStatus("Estado: Desconocido (" + value + ")");
      }
    }

    function handleError(xhr) {
      updateStatus("Error: " + xhr.status + " – " + xhr.responseText);
    }

    function switchOn() {
      $.post(url, { params: "on", access_token: accessToken })
        .done(handleResponse)
        .fail(handleError);
    }

    function switchOff() {
      $.post(url, { params: "off", access_token: accessToken })
        .done(handleResponse)
        .fail(handleError);
    }

    // Ejecutar al cargar la página
    $(document).ready(function() {
      getCurrentLEDStatus();
    });
  </script>
</head>
<body>
  <h1>Control de LED</h1>
  <button onclick="switchOn()">Encender</button>
  <button onclick="switchOff()">Apagar</button>
  <p id="status">Cargando estado del LED...</p>
</body>
</html>
