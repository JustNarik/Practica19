<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de LED</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    var accessToken = "ed2b4b082b6e7f701101ccb4b469675e45735485";
    var deviceID = "0a10aced202194944a055c30";
    var url = "https://api.particle.io/v1/devices/" + deviceID + "/led";

    // Actualizar el estado del LED en la página
    function updateStatus(message) {
      document.getElementById("status").textContent = message;
    }

    // Función para obtener el estado inicial del LED
    function getCurrentLEDStatus() {
      $.get("https://api.particle.io/v1/devices/" + deviceID + "/led", {
        access_token: accessToken
      })
      .done(function(data) {
        if (data.return_value === 0) {
          updateStatus("Estado: LED ENCENDIDO");
        } else if (data.return_value === 1) {
          updateStatus("Estado: LED APAGADO");
        } else {
          updateStatus("Estado: Desconocido");
        }
      })
      .fail(function(xhr) {
        updateStatus("Error al obtener el estado: " + xhr.status + " – " + xhr.responseText);
      });
    }

    // Responder a la petición de encender/apagar el LED
    function handleResponse(data) {
      var value = data.return_value;
      if (value === 0) {
        updateStatus("Estado: LED ENCENDIDO");
      } else if (value === 1) {
        updateStatus("Estado: LED APAGADO");
      } else if (value === -1) {
        updateStatus("Estado: Parámetro inválido");
      } else {
        updateStatus("Estado: Desconocido (" + value + ")");
      }
    }

    // Manejar errores de la petición
    function handleError(xhr) {
      updateStatus("Error: " + xhr.status + " – " + xhr.responseText);
    }

    // Encender el LED
    function switchOn() {
      $.post(url, { params: "on", access_token: accessToken })
        .done(handleResponse)
        .fail(handleError);
    }

    // Apagar el LED
    function switchOff() {
      $.post(url, { params: "off", access_token: accessToken })
        .done(handleResponse)
        .fail(handleError);
    }

    // Obtener el estado del LED al cargar la página
    $(document).ready(function() {
      getCurrentLEDStatus();
    });
  </script>
</head>
<body>
  <h1>Control de LED</h1>
  <button onclick="switchOn()">Encender</button>
  <button onclick="switchOff()">Apagar</button>
  <p id="status">Cargando estado del LED...</p>
</body>
</html>
